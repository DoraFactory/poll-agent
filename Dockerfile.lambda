# Use the AL2023-based Lambda image to ensure manylinux_2_28 wheels are compatible
# (avoids building native deps like pyarrow/tiktoken from source).
FROM public.ecr.aws/lambda/python:3.12

WORKDIR /var/task

# Install runtime deps into the Lambda environment.
# Build requires network access to fetch PyPI dependencies.
COPY pyproject.toml uv.lock ./
COPY src/ ./src/

# Ensure pip is new enough to pick up prebuilt wheels (avoids building Rust/C++ deps like tiktoken/pyarrow).
RUN python -m pip install --no-cache-dir --upgrade pip setuptools wheel
RUN python -m pip install --no-cache-dir .

# Lambda handler (module.function)
CMD ["poll_agent.lambda_handler.handler"]
